{{ 'component-main-bulk-editor.css' | asset_url | stylesheet_tag }}

{%- liquid
    assign padding_top = section.settings.padding_top | append: 'px'
    assign padding_bottom = section.settings.padding_bottom | append: 'px'
    assign padding_top_tablet = section.settings.padding_top_tablet | append: 'px'
    assign padding_bottom_tablet = section.settings.padding_bottom_tablet | append: 'px'
    assign padding_top_mobile = section.settings.padding_top_mobile | append: 'px'
    assign padding_bottom_mobile = section.settings.padding_bottom_mobile | append: 'px'
    assign show_breadcrumb = section.settings.show_breadcrumb
    assign breadcrumb_alignment = section.settings.breadcrumb_alignment
    assign show_page_title = section.settings.show_page_title
    assign page_title_alignment = section.settings.page_title_alignment
    assign container = section.settings.container
-%}

<style type="text/css" media="screen">
    #BulkEditorSection-{{ section.id }}{
        padding-top: {{ padding_top }};
        padding-bottom: {{ padding_bottom }};
    }

    @media (max-width: 1024px) {
        #BulkEditorSection-{{ section.id }}{
            padding-top: {{ padding_top_tablet }};
            padding-bottom: {{ padding_bottom_tablet }};
        }
    }

    @media (max-width: 550px) {
        #BulkEditorSection-{{ section.id }}{
            padding-top: {{ padding_top_mobile }};
            padding-bottom: {{ padding_bottom_mobile }};
        }
    }
</style>

<div data-section-id="{{ section.id }}" data-section-type="page" id="BulkEditorSection-{{ section.id }}" data-section="{{ section.id }}">
    <div class="container container-{{ container }}">
        {%- if show_breadcrumb -%}
            {% render 'breadcrumb', alignment: breadcrumb_alignment %}
        {%- endif -%}
        {%- if show_page_title -%}
            <h1 class="page-header text-{{ page_title_alignment }}">
                {{ page.title | escape }}
            </h1>
        {%- endif -%}
        <div class="halo-page-content">
            <div class="halo-bulk-editor">
                <div class="bulk-editor-content">
                    <div class="bulk-editor-sidebar">
                        <div class="bulk-editor-selector">
                            <div class="label-tab" data-toggle="dropdown" aria-expanded="false" role="button">
                                <span class="label-text">
                                    {{ 'bulk_editor_page.general.select_collection' | t }}
                                </span>
                                <span class="halo-icon-dropdown icon-dropdown" role="none"></span>
                            </div>
                            <ul class="list-unstyled custom-scrollbar">
                                <li>
                                    <a class="all-products" href="javascript:void(0)" data-title="{{ 'bulk_editor_page.general.all_collection' | t }}" data-href="&ids={% for product in category.products %}{{ product.id }}%2C{% endfor %}" data-bulk-list-item role="button">
                                        <span class="text">{{ 'bulk_editor_page.general.all_collection' | t }}</span>
                                    </a>
                                </li>
                                {%- for category in collections -%}
                                    <li>
                                        <a class="product" href="javascript:void(0)" data-title="{{ category.title }}" data-href="&ids={% for product in category.products %}{{ product.id }}%2C{% endfor %}" data-bulk-list-item role="button">
                                            <span class="text">{{ category.title | escape }}</span>
                                        </a>
                                    </li>
                                {%- endfor -%}
                            </ul>
                        </div>
                    </div>
                    <div class="bulk-editor-main">
                        <div class="bulk-editor-listing">
                            <div class="content-item">
                                <input id="short_description" type="checkbox" name="short_description" value="metafields.c_f.short_description" checked>
                                <label class="form-label--checkbox" for="short_description">Short Description</label>
                            </div>
                            <div class="content-item">
                                <input id="countdown" type="checkbox" name="countdown" value="metafields.c_f.countdown" checked>
                                <label class="form-label--checkbox" for="countdown">Countdown</label>
                            </div>
                            <div class="content-item">
                                <input id="sizechart" type="checkbox" name="sizechart" value="metafields.c_f.size_chart" checked>
                                <label class="form-label--checkbox" for="sizechart">Size Chart</label>
                            </div>
                            <div class="content-item">
                                <input id="bundlediscountrate" type="checkbox" name="bundlediscountrate" value="metafields.c_f.bundle_discount_rate" checked>
                                <label class="form-label--checkbox" for="bundlediscountrate">Bundle Discount Rate</label>
                            </div>
                            <div class="content-item">
                                <input id="groupedsubproduct" type="checkbox" name="groupedsubproduct" value="metafields.c_f.grouped_sub_product" checked>
                                <label class="form-label--checkbox" for="groupedsubproduct">Grouped Sub Product</label>
                            </div>
                            <div class="content-item">
                                <input id="custom_tab" type="checkbox" name="custom_tab" value="metafields.c_f.custom_tab" checked>
                                <label class="form-label--checkbox" for="custom_tab">Custom Tab</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bulk-editor-action text-center">
                    <a class="button button--primary bulk-editor-submit" href="" target="_blank" >{{ 'bulk_editor_page.general.submit' | t }}</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(() => {
        $('.bulk-editor-selector .label-tab').on('click', (event) => {
            var buttonElement = event.currentTarget;

            if (buttonElement.getAttribute('aria-expanded') === 'false'){
                buttonElement.setAttribute('aria-expanded', true);
            } else {
                buttonElement.setAttribute('aria-expanded', false);
            }
        });

        $('[data-bulk-list-item]').on('click', (event) => {
            var buttonElement = event.currentTarget;

            if (!buttonElement.classList.contains('is-active')) {
                var value = buttonElement.querySelector('.text').getAttribute('data-value'),
                    href = buttonElement.querySelector('.text').getAttribute('data-href'),
                    text = buttonElement.querySelector('.text').innerText;

                document.querySelector('.bulk-editor-selector .label-text').innerText = text;
                document.querySelector('.bulk-editor-selector [data-toggle]').setAttribute('aria-expanded', false);

                document.querySelectorAll('[data-bulk-list-item]').forEach((sortByButton) => {
                    sortByButton.closest('li').classList.remove('is-active');
                });

                buttonElement.closest('li').classList.add('is-active');
            }
        });

        var arrEditor = [];

        $('.content-item label').on('click', (event) => {
            var value = event.currentTarget.value,
                href = event.currentTarget.dataset.href,
                character = arrEditor.join(':string,'),
                link = document.querySelector('.bulk-editor-submit').getAttribute('href');

            arrEditor.push(value);
            link.replace('edit=', 'edit=' + character);
        });

        $('.bulk-editor-submit').on('click', (event) => {
            event.preventDefault();

            var arrEditor = [],
                href = event.currentTarget.getAttribute('href');

            if($('.bulk-editor-listing input:checked').length == 0){
                alert('Please choose metafields');
            } else {
                $('.bulk-editor-listing input[type=checkbox]').each((index, element) => {
                    if (element.checked) {
                        var value = element.value;

                        arrEditor.push(value);
                    }
                });

                var character = arrEditor.join(':string,'),
                    id = '';

                event.currentTarget.setAttribute('href', `/admin/bulk?resource_name=Product&edit=${character}`);

                if ($('.bulk-editor-selector .product').parent().hasClass('is-active')) {
                    id = '&ids=' + $('.bulk-editor-selector li.is-active .product').data('href');
                } else if($('.bulk-editor-selector .all-products').parent().hasClass('is-active')){
                    id = '';
                }

                var finalLink = `/admin/bulk?resource_name=Product&edit=${character}${id}`;

                window.open(finalLink, '_blank');
            }
        });

        $(document).on('click', (event) => {
            if ($(event.target).closest('.bulk-editor-selector').length === 0) {
                document.querySelector('.bulk-editor-selector [data-toggle]').setAttribute('aria-expanded', false);
            }
        });
    });
</script>

{% schema %}
    {
        "name": "t:sections.main-page.name",
        "settings":
        [{
            "type": "header",
            "content": "t:sections.main-page.settings.header__1.content"
        },
        {
            "type": "checkbox",
            "id": "show_breadcrumb",
            "label": "t:sections.general.settings.breadcrumb.label__1",
            "default": true
        },
        {
            "type": "select",
            "id": "breadcrumb_alignment",
            "label": "t:sections.general.settings.breadcrumb.label__2",
            "options": [
            {
                "value": "left",
                "label": "t:sections.general.settings.breadcrumb.options__1"
            },
            {
                "value": "center",
                "label": "t:sections.general.settings.breadcrumb.options__2"
            },
            {
                "value": "right",
                "label": "t:sections.general.settings.breadcrumb.options__3"
            }],
            "default": "left"
        },
        {
            "type": "checkbox",
            "id": "show_page_title",
            "label": "t:sections.general.settings.page-title.label__1",
            "default": true
        },
        {
            "type": "select",
            "id": "page_title_alignment",
            "label": "t:sections.general.settings.page-title.label__2",
            "options": [
            {
                "value": "left",
                "label": "t:sections.general.settings.page-title.options__1"
            },
            {
                "value": "center",
                "label": "t:sections.general.settings.page-title.options__2"
            },
            {
                "value": "right",
                "label": "t:sections.general.settings.page-title.options__3"
            }],
            "default": "left"
        },
        {
            "type": "select",
            "id": "container",
            "label": "t:sections.general.settings.container.label__1",
            "default": "1370",
            "options": [
            {
                "value": "1170",
                "label": "t:sections.general.settings.container.options__1"
            },
            {
                "value": "1370",
                "label": "t:sections.general.settings.container.options__2"
            },
            {
                "value": "1570",
                "label": "t:sections.general.settings.container.options__3"
            },
            {
                "value": "1770",
                "label": "t:sections.general.settings.container.options__4"
            },
            {
                "value": "1860",
                "label": "t:sections.general.settings.container.options__5"
            },
            {
                "value": "full",
                "label": "t:sections.general.settings.container.options__6"
            }],
            "info": "t:sections.general.settings.container.info"
        },
        {
            "type": "paragraph",
            "content": "t:sections.general.settings.padding.paragraph__1.content"
        },
        {
            "type": "range",
            "id": "padding_top",
            "label": "t:sections.general.settings.padding.label__1",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "t:sections.general.settings.padding.unit",
            "default": 0
        },
        {
            "type": "range",
            "id": "padding_bottom",
            "label": "t:sections.general.settings.padding.label__2",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "t:sections.general.settings.padding.unit",
            "default": 0
        },
        {
            "type": "paragraph",
            "content": "t:sections.general.settings.padding.paragraph__2.content"
        },
        {
            "type": "range",
            "id": "padding_top_tablet",
            "label": "t:sections.general.settings.padding.label__1",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "t:sections.general.settings.padding.unit",
            "default": 40
        },
        {
            "type": "range",
            "id": "padding_bottom_tablet",
            "label": "t:sections.general.settings.padding.label__2",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "t:sections.general.settings.padding.unit",
            "default": 40
        },
        {
            "type": "paragraph",
            "content": "t:sections.general.settings.padding.paragraph__3.content"
        },
        {
            "type": "range",
            "id": "padding_top_mobile",
            "label": "t:sections.general.settings.padding.label__1",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "t:sections.general.settings.padding.unit",
            "default": 30
        },
        {
            "type": "range",
            "id": "padding_bottom_mobile",
            "label": "t:sections.general.settings.padding.label__2",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "t:sections.general.settings.padding.unit",
            "default": 30
        }]
    }
{% endschema %}