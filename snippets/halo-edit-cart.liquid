<div class="cart-edit" data-template-cart-edit data-count="1">
    {%- liquid
        assign file_extension = 'png'
        assign current_variant = product.selected_or_first_available_variant
        assign variantCount = product.variants | size
        assign swatch_style = settings.swatch_style
        assign show_customization_option = settings.show_customization_option
        if show_customization_option
            assign has_customization_option = false
            assign customization_option_type = settings.customization_option_type
            assign customization_option_hidden = settings.customization_option_hidden
            if customization_option_type == 'all'
                assign has_customization_option = true
            elsif customization_option_type == 'tag'
                assign customization_option_tags = settings.customization_option_tags | split: "," | strip | downcase | handle
                for tag in customization_option_tags
                    assign tagtitle = tag | escape | downcase | handle
                    if product.tags contains tagtitle
                        assign has_customization_option = true
                    endif
                endfor
            elsif customization_option_type == 'collection'
                assign customization_option_collection = settings.customization_option_collection | downcase | handle
                if customization_option_collection != blank
                    for collection in product.collections
                        assign collection_title = collection.title | downcase | handle
                        if collection_title == customization_option_collection
                            assign has_customization_option = true
                        endif
                    endfor
                endif
            endif
            assign customization_option_1 = settings.customization_option_1
            assign customization_option_2 = settings.customization_option_2
        endif
    -%}
    <script>
        window.edit_cart_inven_array_{{ product.id }} = {
            {% for variant in product.variants %}
                '{{ variant.id }}': '{{ variant.inventory_quantity }}',
            {% endfor %}
        };
    </script>
    <div class="product-edit-item product-edit-itemFirst isChecked clearfix" id="product-edit-{{ product.id }}" data-cart-edit-id="{{ product.id }}" data-position="0">
        <div class="product-edit-itemLeft">
            {%- liquid 
                if current_variant.image
                    assign image = current_variant.image
                else
                    assign image = product.featured_image.src
                endif

                assign media_size = settings.quick_edit_cart_image_ratio
                assign portrait_aspect_ratio = settings.quick_edit_cart_portrait_aspect_ratio | append: '%'
            -%}
            <a class="product-edit-image card-media--{{ media_size }}" href="{{ product.url | within: collection }}"
                {% if media_size == 'adapt' %}
                    style="padding-bottom: {{ 1 | divided_by: image.aspect_ratio | times: 100 }}%;"
                {% elsif media_size == 'square' %}
                    style="padding-bottom: 100%;"
                {% elsif media_size == 'portrait' %}
                    style="padding-bottom: {{ portrait_aspect_ratio }};"
                {% endif %}
            >
                <img srcset="{% if image.width >= 288 %}{{ image | img_url: '288x' }} 288w,{% endif %}
                        {% if image.width >= 576 %}{{ image | img_url: '576x' }} 576w,{% endif %}
                        {% if image.width >= 550 %}{{ image | img_url: '550x' }} 550w,{% endif %}
                        {% if image.width >= 1100 %}{{ image | img_url: '1100x' }} 1100w{% endif %}"
                    src="{{ image | img_url: 'master' }}"
                    alt="{{ product.title | escape }}"
                    sizes="auto"
                    loading="lazy"
                >
            </a>
            <a href="javascript:void(0)" class="product-edit-remove" data-edit-cart-remove>
                {% render 'icon-close' %}
            </a>
        </div>
        <div class="product-edit-itemRight">
            <h3 class="product-edit-title">
                {{ product.title | escape }}
                <span data-change-title> - {{ current_variant.title }}</span>
            </h3>
            <div class="product-edit-price">
                <span class="compare-price old-price" {% unless current_variant.compare_at_price %}style="display: none;"{% endunless %}>
                    {{ current_variant.compare_at_price | money }}
                </span>
                <span class="price{% if current_variant.compare_at_price %} new-price{% endif %}">
                    {{ current_variant.price | money }}
                </span>
            </div>
            <div class="product-edit-options halo-productOptions" id="product-edit-options-{{ product.id }}" data-type="{{ settings.quick_edit_cart_picker_type }}">
                {%- if variantCount > 0  and product.has_only_default_variant != true  -%}
                    {%- if settings.quick_edit_cart_picker_type == 'button' -%}
                        {%- assign product_swatch_option = settings.swatch | downcase -%}
                        <variant-edit-radios class="no-js-hidden product-edit-option has-default" data-product="{{ product.id }}" data-url="{{ product.url }}">
                            {%- for option in product.options_with_values -%}
                                {%- liquid
                                    assign is_swatch = false
                                    assign option_name = option.name | downcase
                                    if product_swatch_option contains option_name
                                        assign is_swatch = true
                                    endif
                                    assign swatch_type = settings.swatch_type
                                    assign option_index = forloop.index0
                                -%}
                                <fieldset class="js product-form__input{% if is_swatch %} product-form__swatch{% endif %} clearfix" data-product-attribute="set-rectangle" data-option-index="{{ forloop.index0 }}">
                                    <legend class="form__label">
                                        {{ option.name | append: ':' }}
                                        <span data-header-option>
                                            {{ option.selected_value }}
                                        </span>
                                    </legend>
                                    {%- assign values = '' -%}
                                    {%- for variant in product.variants -%}
                                        {%- assign value = variant.options[option_index] -%}
                                        {%- unless values contains value -%}
                                            {%- liquid
                                                assign values = values | join: ';'
                                                assign values = values | append: ';' | append: value
                                                assign values = values | split: ';'
                                            -%}
                                            <input class="product-form__radio" type="radio" id="option-edit-{{ product.id }}-{{ option.name }}-{{ forloop.index0 }}"
                                                name="{{ option.name }}"
                                                value="{{ value | escape }}"
                                                {% if option.selected_value == value %}checked{% endif %}
                                            >
                                            {%- if is_swatch -%}
                                                <label class="product-form__label style-{{ swatch_style }}{% if variant.available %} available{% else %} soldout{% endif %}" for="option-edit-{{ product.id }}-{{ option.name }}-{{ forloop.index0 }}" role="button" tabindex="0">
                                                    {%- if variant.image %}
                                                        <span class="pattern" style="background-image: url({{ variant.image.src | product_img_url: '40x'}});" role="none"></span>
                                                        <span class="visually-hidden">{{ value | escape }}</span>
                                                        <span class="expand">
                                                            <img srcset="{{ variant.image.src | product_img_url: '75x'}}" src="{{ variant.image.src | product_img_url: '75x'}}" sizes="auto" loading="lazy" alt="{{ value | escape }}">
                                                        </span>
                                                    {%- else -%}
                                                        {%- if swatch_type == 'png' -%}
                                                            <span class="pattern" style="background-image: url({{ value | handle | append: '.' | append: file_extension | file_url }})" role="none"></span>
                                                        {%- else -%}
                                                            <span class="pattern" style="background-color: {{ value | split: ' ' | last | handle }};" role="none"></span>
                                                        {%- endif -%}
                                                        <span class="visually-hidden">{{ value | escape }}</span>
                                                        <span class="tooltip">
                                                            {{ value | escape }}
                                                        </span>
                                                    {%- endif -%}
                                                </label>
                                            {%- else -%}   
                                                <label class="product-form__label{% if value.size >= 5 %} product-form__labelLagre{% endif %}{% if variant.available %} available{% else %} soldout{% endif %}" for="option-edit-{{ product.id }}-{{ option.name }}-{{ forloop.index0 }}" role="button" tabindex="0">
                                                    <span class="text">{{ value }}</span>
                                                </label>
                                            {%- endif -%}
                                        {%- endunless -%}
                                    {%- endfor -%}
                                </fieldset>
                            {%- endfor -%}
                            <div class="product-edit-message alertBox alertBox--info" style="display: none;">
                                <p class="alertBox-message"></p>
                            </div>
                            <script type="application/json">
                                {{ product.variants | json }}
                            </script>
                        </variant-edit-radios>
                    {%- else -%}
                        <variant-edit-selects class="no-js-hidden product-edit-option has-default" data-product="{{ product.id }}" data-url="{{ product.url }}">
                            {%- for option in product.options_with_values -%}
                                <div class="product-form__input product-form__input--dropdown" data-product-attribute="set-select" data-option-index="{{ forloop.index0 }}">
                                    <label class="form__label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
                                        {{ option.name | append: ':' }}
                                        <span data-header-option>
                                            {{ option.selected_value }}
                                        </span>
                                    </label>
                                    <div class="form__select select">
                                        <select id="Option-{{ section.id }}-{{ forloop.index0 }}"
                                            class="select__select"
                                            name="options[{{ option.name | escape }}]"
                                        >
                                            {%- for value in option.values -%}
                                                <option value="{{ value | escape }}" {% if option.selected_value == value %}selected="selected"{% endif %}>
                                                    {{ value }}
                                                </option>
                                            {%- endfor -%}
                                        </select>
                                    </div>
                                </div>
                            {%- endfor -%}
                            <script type="application/json">
                                {{ product.variants | json }}
                            </script>
                        </variant-edit-selects>
                    {%- endif -%}
                    {%- if settings.show_hot_stock -%}
                        {% assign productMaxStock = settings.hot_stock_limit | plus: 0 %}
                        <div class="product-edit-hotStock" data-edit-cart-hot-stock="{{ productMaxStock }}">
                            {%- if current_variant.inventory_management -%}
                                {%- if current_variant.inventory_quantity > 0 and current_variant.inventory_quantity <= productMaxStock -%}
                                    {{ 'products.product.hot_stock' | t : inventory: current_variant.inventory_quantity }}
                                {%- endif -%}
                            {%- endif -%}
                        </div>
                    {%- endif -%}
                {%- endif -%}
            </div>
            <product-form class="product-form">
                {%- assign product_form_id = 'product-form-edit-' | append: product.id -%}
                {%- form 'product', product, id: product_form_id, novalidate: 'novalidate' -%}
                    <input type="hidden" name="id" value="{{ current_variant.id }}">
                    {%- if show_customization_option and has_customization_option -%}
                        {%- if customization_option_1 != blank or customization_option_2 != blank -%}
                            {%- if customization_option_1 != blank -%}
                                {%- liquid
                                    assign property_id = product.id | append: customization_option_1 | handleize
                                    assign property_name = customization_option_1 | escape
                                    assign property_value = property_name
                                    unless customization_option_hidden
                                        assign property_value = property_value | prepend: '_'
                                    endunless
                                -%}
                                <div class="product-form__input clearfix line-item-property__field">
                                    <label for="{{ property_id }}" class="form-label form__label">{{ property_name }}</label>
                                    <input id="{{ property_id }}" type="text" name="properties[{{ property_value }}]" class="form__input form-input">
                                </div>
                            {%- endif -%}
                            {%- if customization_option_2 != blank -%}
                                {%- liquid
                                    assign property_id = product.id | append: customization_option_2 | handleize
                                    assign property_name = customization_option_2 | escape
                                    assign property_value = property_name
                                    unless customization_option_hidden
                                        assign property_value = property_value | prepend: '_'
                                    endunless
                                -%}
                                <div class="product-form__input clearfix line-item-property__field">
                                    <label for="{{ property_id }}" class="form-label form__label">{{ property_name }}</label>
                                    <input id="{{ property_id }}" type="file" accept="image/*" name="properties[{{ property_value }}]" class="form__input form-input">
                                </div>
                            {%- endif -%}
                        {%- endif -%}
                    {%- endif -%}
                    <quantity-edit-cart-input class="product-edit-quantity quantity__group">
                        <label class="form-label quantity__label" for="edit-quantity-{{ product.id }}">
                            {{ 'products.product.quantity.label' | t }}:
                        </label>
                        <input class="form-input quantity__input" type="number" id="edit-quantity-{{ product.id }}" name="quantity" min="1" value="1" pattern="[0-9]*" {% if current_variant.inventory_management != null and current_variant.inventory_quantity > 0 %} data-quantity="{{ current_variant.inventory_quantity }}"{% endif %}>
                        <span class="quantity__message"></span>
                    </quantity-edit-cart-input>
                {%- endform -%}
            </product-form>
            {%- if settings.show_notify_form -%}
                <div class="product-edit-notifyMe halo-notifyMe" style="display: none;">
                    {% render 'halo-notify-sold-out',
                        id: product.id,
                        current_variant: current_variant
                    %}
                </div>
            {%- endif -%}
            <a href="javascript:void(0)" class="add-more link link-underline text-underline" data-edit-cart-add-more>
                <span class="text">{{ 'products.product.add.label' | t }}</span>
            </a>
        </div>
    </div>
    <div class="product-edit-action">
        <button data-update-cart-edit class="button button-height" id="add-all-to-cart">{{ 'products.product.add_to_cart' | t }}</button>
    </div>
</div>